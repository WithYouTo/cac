<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qcap.cac.dao.TaskArrangeMapper">

	<select id="listTaskArrange"  parameterType="com.qcap.cac.dto.TaskArrangeSearchDto" resultType="Map">
		SELECT
		m.ARRANGEMENT_ID  AS  arrangementId,
		m.SHIFT  AS  shift,
		m.EMPLOYEE_CODE  AS  employeeCode,
		m.EMPLOYEE_NAME  AS  employeeName,
		m.EMPLOYEE_TEL  AS  employeeTel,
		m.POSITION_CODE  AS  positionCode,
		m.POSITION_NAME  AS  positionName,
		m.MONTH  AS  month,
		m.DAY_1  AS  day1,
		m.DAY_2  AS  day2,
		m.DAY_3  AS  day3,
		m.DAY_4  AS  day4,
		m.DAY_5  AS  day5,
		m.DAY_6  AS  day6,
		m.DAY_7  AS  day7,
		m.DAY_8  AS  day8,
		m.DAY_9  AS  day9,
		m.DAY_10  AS  day10,
		m.DAY_11  AS  day11,
		m.DAY_12  AS  day12,
		m.DAY_13  AS  day13,
		m.DAY_14  AS  day14,
		m.DAY_15  AS  day15,
		m.DAY_16  AS  day16,
		m.DAY_17  AS  day17,
		m.DAY_18  AS  day18,
		m.DAY_19  AS  day19,
		m.DAY_20  AS  day20,
		m.DAY_21  AS  day21,
		m.DAY_22  AS  day22,
		m.DAY_23  AS  day23,
		m.DAY_24  AS  day24,
		m.DAY_25  AS  day25,
		m.DAY_26  AS  day26,
		m.DAY_27  AS  day27,
		m.DAY_28  AS  day28,
		m.DAY_29  AS  day29,
		m.DAY_30  AS  day30,
		m.DAY_31  AS  day31
		FROM tb_task_arrangement m
		WHERE m.SHIFT =#{shift}
		AND m.MONTH=#{month}
		<if test=' programCode !=null and programCode !="" '>
			AND m.PROGRAM_CODE  =#{programCode}
		</if>
		<if test=' positionCode !=null and positionCode !="" '>
		AND m.POSITION_CODE  =#{positionCode}
		</if>
		<if test=' employeeCode !=null and employeeCode !="" '>
			AND m.EMPLOYEE_CODE  LIKE CONCAT('%',#{employeeCode},'%')
		</if>
		<if test=' employeeName !=null and employeeName !="" '>
			AND m.EMPLOYEE_NAME  LIKE CONCAT('%',#{employeeName},'%')
		</if>
		AND m.DELETE_FLAG !='DELETE'
	</select>
	
	<insert id="insertTaskArrangeBatch" parameterType="List">
    insert into tb_task_arrangement (ARRANGEMENT_ID, SHIFT, EMPLOYEE_CODE, 
      EMPLOYEE_NAME, EMPLOYEE_TEL, POSITION_CODE, 
      POSITION_NAME, MONTH, DELETE_FLAG,PROGRAM_CODE,
      DAY_1, DAY_2, DAY_3, DAY_4, 
      DAY_5, DAY_6, DAY_7, DAY_8, 
      DAY_9, DAY_10, DAY_11, 
      DAY_12, DAY_13, DAY_14, 
      DAY_15, DAY_16, DAY_17, 
      DAY_18, DAY_19, DAY_20, 
      DAY_21, DAY_22, DAY_23, 
      DAY_24, DAY_25, DAY_26, 
      DAY_27, DAY_28, DAY_29, 
      DAY_30, DAY_31, REMARK1, 
      REMARK2, REMARK3, CREATE_EMP, 
      CREATE_DATE, UPDATE_DATE, UPDATE_EMP, 
      VERSION)
    values 
    <foreach collection="list" index="index" item="item" separator=",">
    (#{item.arrangementId}, #{item.shift}, #{item.employeeCode}, 
      #{item.employeeName}, #{item.employeeTel}, #{item.positionCode}, 
      #{item.positionName}, #{item.month}, #{item.deleteFlag},#{item.programCode},
      #{item.day1}, #{item.day2}, #{item.day3}, #{item.day4}, 
      #{item.day5}, #{item.day6}, #{item.day7}, #{item.day8}, 
      #{item.day9}, #{item.day10}, #{item.day11}, 
      #{item.day12}, #{item.day13}, #{item.day14}, 
      #{item.day15}, #{item.day16}, #{item.day17}, 
      #{item.day18}, #{item.day19}, #{item.day20}, 
      #{item.day21}, #{item.day22}, #{item.day23}, 
      #{item.day24}, #{item.day25}, #{item.day26}, 
      #{item.day27}, #{item.day28}, #{item.day29}, 
      #{item.day30}, #{item.day31}, #{item.remark1}, 
      #{item.remark2}, #{item.remark3}, #{item.createEmp}, 
      #{item.createDate}, #{item.updateDate}, #{item.updateEmp}, 
      #{item.version})
      </foreach>
  </insert>
	
	<update id="deleteTaskArrange" parameterType="com.qcap.cac.dto.TaskArrangeDto">
	UPDATE tb_task_arrangement SET 
	DELETE_FLAG='DELETE' 
	WHERE SHIFT =#{shift} 
	AND `MONTH`=#{month} 
	AND CREATE_EMP =#{createEmp}
	</update>

	<select id="selectPositionItem" parameterType="String" resultType="Map">
		SELECT POSITION_CODE AS id,POSITION_NAME AS text FROM tb_area_position
		<where>
			<if test=' programCode !=null and programCode !="" '>
			 PROGRAM_CODE = #{programCode}
			</if>
		</where>
	</select>

	<select id="queryIfPositionExist" parameterType="Map" resultType="String">
		SELECT
			SHIFT AS shift
		FROM
			tb_area_position
		WHERE
			POSITION_CODE = #{positionCode}
		AND POSITION_NAME = #{positionName}
	</select>

	<select id="queryIfEmployeeExist" parameterType="Map" resultType="String">
		SELECT
			account
		FROM
			tb_manager
		WHERE
			account = #{employeeCode}
		AND `name` = #{employeeName}
		AND `status` = '1'
	</select>

</mapper>
