<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qcap.cac.dao.EquipUseMapper">

    <select id="listEquipUse" resultType="java.util.Map" parameterType="com.qcap.cac.dto.EquipUseSearchDto">
        select
        EQUIP_USE_ID equipUseId,
        EQUIP_ID equipId,
        EQUIP_NAME equipName,
        EQUIP_NO equipNo,
        EQUIP_TYPE equipType,
        EQUIP_MODEL equipModel,
        DATE_FORMAT(START_USE_TIME,'%Y-%m-%d %H:%i:%S') startUseTime,
        DATE_FORMAT(END_USE_TIME,'%Y-%m-%d %H:%i:%S') endUseTime,
        TOTAL_USE_TIME totalUseTime,
        AREA area,
        PERSON_NAME personName,
        PERSON_MOBILE personMobile,
        STATUS status
        from TB_EQUIP_USE
        where 1=1
        <if test="obj.equipNo != null and obj.equipNo != ''">
            and EQUIP_NO = #{obj.equipNo}
        </if>
        <if test="obj.startUseTime != null and obj.startUseTime != ''">
            and START_USE_TIME &gt; #{obj.startUseTime}
        </if>
        <if test="obj.status != null and obj.status != ''">
            and STATUS = #{obj.status}
        </if>
        ORDER BY START_USE_TIME
    </select>


    <select id="getUseTotalTimeByEquipId" resultType="java.lang.String" parameterType="java.lang.String">
        select
        sum(TOTAL_USE_TIME) total
        from TB_EQUIP_USE
        where
        EQUIP_ID = #{equipId}
    </select>

    <insert id="insertEquipUse" parameterType="com.qcap.cac.entity.TbEquipUse">
        INSERT INTO tb_equip_use
        (EQUIP_USE_ID,EQUIP_ID,EQUIP_NO,EQUIP_NAME,EQUIP_TYPE,EQUIP_MODEL,AREA,PERSON_NO,PERSON_NAME,PERSON_MOBILE,START_USE_TIME,STATUS,CREATE_EMP,CREATE_DATE,UPDATE_EMP,UPDATE_DATE)
        VALUE
        (#{equipUseId},#{equipId},#{equipNo},#{equipName},#{equipType},#{equipModel},#{area},#{personNo},#{personName},#{personMobile},#{startUseTime},#{status},#{createEmp},now(),#{updateEmp},now())
    </insert>

    <select id="getEquipUseIdByEquipNoAndStatus" resultType="com.qcap.cac.entity.TbEquipUse" parameterType="java.lang.String">
        select
        EQUIP_USE_ID equipUseId,
        START_USE_TIME startUseTime
        from tb_equip_use
        where
        EQUIP_NO = #{equipNo}
        AND
        STATUS ='INUSE'
    </select>

    <update id="updateEquipUseByEquipUseId" parameterType="com.qcap.cac.entity.TbEquipUse">
         UPDATE tb_equip_use
        SET
        TOTAL_USE_TIME = #{totalUseTime},
        END_USE_TIME = #{endUseTime},
        STATUS = #{status},
        UPDATE_EMP = #{updateEmp},
        UPDATE_DATE = #{updateDate}
        where
        EQUIP_USE_ID = #{equipUseId}
    </update>
</mapper>
