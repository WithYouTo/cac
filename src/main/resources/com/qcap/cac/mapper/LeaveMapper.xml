<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qcap.cac.dao.LeaveMapper">

    <select id="listLeave" resultType="java.util.Map" parameterType="com.qcap.cac.dto.AttenceSearchDto">
        SELECT
        l.LEAVE_ID leaveId,
        l.PERSON_ID personId,
        l.WORK_NO workNo,
        l.PERSON_NAME personName,
        l.PERSON_MOBILE personMobile,
        l.LEAVE_REASON leaveReason,
        l.PROGRAM_CODE programCode,
        p.PROGRAM_NAME programName,
        DATE_FORMAT(l.LEAVE_START_TIME,'%Y-%m-%d %H:%i:%S') leaveStartTime,
        DATE_FORMAT(l.LEAVE_END_TIME,'%Y-%m-%d %H:%i:%S') leaveEndTime,
        l.LEAVE_TOTAL_TIME leaveTotalTime,
        l.LEAVE_STATUS leaveStatus,
        l.REMARK remark
        FROM TB_LEAVE l
        LEFT JOIN tb_program p
        ON l.PROGRAM_CODE = p.PROGRAM_CODE
        WHERE 1=1
        <if test="obj.workNo != null and obj.workNo != ''">
            and l.WORK_NO like concat(concat('%',#{obj.workNo}),'%')
        </if>
        <if test="obj.personName != null and obj.personName != ''">
            and l.PERSON_NAME like concat(concat('%',#{obj.personName}),'%')
        </if>
        <if test="obj.leaveStartTime != null and obj.leaveStartTime != ''">
            and l.LEAVE_START_TIME &gt; substring(#{obj.leaveStartTime},1,19)
        </if>
        <if test="obj.leaveStartTime != null and obj.leaveStartTime != ''">
            and l.LEAVE_START_TIME &lt; substring(#{obj.leaveStartTime},22,19)
        </if>
        <if test="obj.programCode != null and obj.programCode != ''">
            AND l.PROGRAM_CODE = #{obj.programCode}
        </if>
        ORDER BY l.LEAVE_START_TIME DESC
    </select>

</mapper>
