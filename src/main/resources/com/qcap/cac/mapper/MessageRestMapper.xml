<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qcap.cac.dao.MessageRestMapper">

	<select id="getMessageForNewest" parameterType="com.qcap.cac.dto.GetMessageReq" resultType="com.qcap.cac.entity.TbMessage">
		SELECT
			MESSAGE_ID messageId,
			TITLE title,
			CONTENT content,
			READ_FLAG readFlag,
			USER_ID userId,
			LINE_NO lineNo,
			REMARK1 remark1,
			REMARK2 remark2,
			REMARK3 remark3,
			CREATE_EMP createEmp,
			CREATE_DATE createDate,
			UPDATE_EMP updateEmp,
			UPDATE_DATE updateDate,
			VERSION version
		FROM
			tb_message T
		WHERE USER_ID = #{employeeCode} 
		ORDER BY LINE_NO DESC
		LIMIT 0,3
	</select>
	
	<select id="getMessage" parameterType="com.qcap.cac.dto.GetMessageReq" resultType="com.qcap.cac.entity.TbMessage">
		SELECT
			MESSAGE_ID messageId,
			TITLE title,
			CONTENT content,
			READ_FLAG readFlag,
			USER_ID userId,
			LINE_NO lineNo,
			REMARK1 remark1,
			REMARK2 remark2,
			REMARK3 remark3,
			CREATE_EMP createEmp,
			CREATE_DATE createDate,
			UPDATE_EMP updateEmp,
			UPDATE_DATE updateDate,
			VERSION version
		FROM
			tb_message T
		WHERE USER_ID = #{employeeCode} 
			<if test="lineNo != null and lineNo != ''">
				AND LINE_NO &gt;= #{lineNo}
			</if>
		ORDER BY LINE_NO DESC
		LIMIT 0,10
	</select>
	
	<update id="updateMessageForRead" parameterType="com.qcap.cac.entity.TbMessage">
		UPDATE tb_message SET
			READ_FLAG  = #{readFlag},
			UPDATE_EMP = #{updateEmp},
			UPDATE_DATE = #{updateDate},
			VERSION = VERSION + 1
		WHERE 
			MESSAGE_ID = #{messageId}
	</update>
	
	
  
</mapper>