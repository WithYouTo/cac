<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.qcap.cac.dao.EquipPlanMapper">

    <select id="listEquipPlan" resultType="java.util.Map" parameterType="com.qcap.cac.dto.EquipPlanSearchDto">
        SELECT
        PLAN_ID planId,
        EQUIP_ID equipId,
        EQUIP_NAME equipName,
        EQUIP_TYPE equipType,
        EQUIP_MODEL equipModel,
        DATE_FORMAT(START_USE_DATE,'%Y-%m-%d') startUseDate,
        LIFE_CYCLE lifeCycle,
        PARTS_ID partsId,
        PARTS_NO partsNo,
        PARTS_NAME partsName,
        MAINT_CYCLE maintCycle,
        DATE_FORMAT(LATEST_MAINT_DATE,'%Y-%m-%d') latestMaintDate,
        DATE_FORMAT(NEXT_MAINT_DATE,'%Y-%m-%d') nextMaintDate,
        REMARK remark
        FROM TB_EQUIP_PLAN
        WHERE 1=1
        <if test="equipType != null and equipType != ''">
            and EQUIP_TYPE = #{equipType}
        </if>
        <if test="equipName != null and equipName != ''">
            and EQUIP_NAME = #{equipName}
        </if>
        <if test="equipModel != null and equipModel != ''">
            and EQUIP_MODEL = #{equipModel}
        </if>
        <if test="latestMaintTime != null and latestMaintTime != ''">
            and LATEST_MAINT_TIME &gt; #{latestMaintTime}
        </if>
        ORDER BY LATEST_MAINT_DATE
    </select>


    <select id="listPartsPlanByEquipId" parameterType="java.lang.String"  resultType="java.util.Map">
        SELECT
        PLAN_ID planId,
        EQUIP_ID equipId,
        EQUIP_NAME equipName,
        EQUIP_TYPE equipType,
        EQUIP_MODEL equipModel,
        PARTS_ID partsId,
        PARTS_NO partsNo,
        PARTS_NAME partsName,
        MAINT_CYCLE maintCycle,
        DATE_FORMAT(LATEST_MAINT_DATE,'%Y-%m-%d') latestMaintDate,
        DATE_FORMAT(NEXT_MAINT_DATE,'%Y-%m-%d') nextMaintDate,
        REMARK remark
        FROM TB_EQUIP_PLAN
        WHERE
        EQUIP_ID = #{equipId}
    </select>
</mapper>
